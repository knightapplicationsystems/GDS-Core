var win;var actInd;var activityWindow;var activityBg;var row;var tableData=[];var tableview;var sound;var alertMessage;var fStripped;var actInd;var adView;var lblUnableToConnect;var btnRetry;var failureMessage;var imgNav;win=Ti.UI.currentWindow;win.backgroundImage='../images/background.png'
Ti.Media.defaultAudioSessionMode=Ti.Media.AUDIO_SESSION_MODE_PLAYBACK;alertMessage=Ti.UI.createAlertDialog({title:'Alert',message:'Alert Message'});failureMessage=Ti.UI.createAlertDialog({title:'Alert',message:'Alert Message'});function showIndicator(){actInd=Ti.UI.createActivityIndicator({style:Ti.UI.iPhone.ActivityIndicatorStyle.BIG,message:'Please Wait..',color:'white',height:60,width:'auto'});activityWindow=Ti.UI.createWindow({width:200,height:100});activityBg=Ti.UI.createView({backgroundColor:"#000000",opacity:0.8,borderRadius:10});activityWindow.add(activityBg);activityWindow.add(actInd);activityWindow.open();actInd.show();}
function hideIndicator(){activityWindow.close();}
callService();if(Ti.Platform.name=='android'){win.title='Shows';}
else
{win.barImage='../images/GDS_APP_HEADER.png';if(Ti.Platform.osname=='ipad'){win.barImage='../images/gds_iPad_HEADER.png';}
adView=Ti.UI.iOS.createAdView({width:'auto',height:50,bottom:0});win.add(adView);if(Ti.Platform.osname=='ipad'){imgNav=Ti.UI.createLabel({top:0,height:50,left:0,backgroundImage:'../images/gds_iPad_shows.png'});}
else
{imgNav=Ti.UI.createLabel({top:0,height:50,left:0,backgroundImage:'../images/NAV_Header_SHOWS.png'});}
win.add(imgNav);}
function callService()
{if(Ti.Platform.name=='android'){}
else
{showIndicator();}
var xhr=Ti.Network.createHTTPClient();xhr.onload=serviceResponse;xhr.onerror=function(){hideIndicator();Ti.API.info('Am I dead yet?');Ti.API.info("Error in webserver");failureMessage.message="Unable to connect to Soundcloud, Please try again later (For best results use a 3G or WiFi connection)";failureMessage.show();lblUnableToConnect=Ti.UI.createLabel({text:'Sorry we are unable to connect you to Soundcloud at this time, please try again later',height:'auto',top:80,left:10,color:'White',font:{fontSize:15,fontStyle:'normal'},textAlign:'left'});if(Ti.Platform.name=='android'){btnRetry=Ti.UI.createButton({top:200,left:10,width:300,height:40,color:'black',text:'Retry',font:{fontSize:30,fontFamily:'Arial',fontWeight:'bold'}});}
btnRetry=Ti.UI.createButtonBar({top:170,left:10,width:300,height:40,labels:['Retry'],style:Ti.UI.iPhone.SystemButtonStyle.BAR,font:{fontSize:15,fontFamily:'Arial',fontWeight:'bold'}});win.add(btnRetry,lblUnableToConnect);btnRetry.addEventListener('click',function(e)
{Ti.API.info('FIred');if(lblUnableToConnect.visible=true)
{Ti.API.info('Idiot');lblUnableToConnect.visible=false;}
if(btnRetry.visible=true)
{Ti.API.info('Idiot2');btnRetry.visible=false;}
callService();});}
var url='https://api.soundcloud.com/users/globaldancesession/tracks.json?client_id=7a0984726d0eefbb310771c4c02116a8';xhr.open("GET",url);xhr.setRequestHeader('Content-Type','application/json');xhr.send();}
function serviceResponse()
{Ti.API.info(this.responseText);var info;info=JSON.parse(this.responseText);Ti.API.warn(info);for(var i in info)
{row=Ti.UI.createTableViewRow({height:36,backgroundColor:'transparent',hasChild:true,rightImage:'../images/Arrow.png'});if(Ti.Platform.osname=='ipad'){row.height=80;}
var preStrippedText;preStrippedText=info[i].title;var strippedText=preStrippedText.replace('Global Dance Session','');fStripped=strippedText.replace(' on','');if(Ti.Platform.name=='android'){row.height='auto';var infoDesc=Ti.UI.createLabel({text:fStripped,color:'White',textAlign:'left',left:10,top:8,height:'auto',font:{fontWeight:'bold',fontSize:25}});}
else
if(Ti.Platform.osname=='ipad'){var infoDesc=Ti.UI.createLabel({text:fStripped,color:'White',textAlign:'left',left:10,top:8,height:'auto',font:{fontWeight:'bold',fontSize:20}});}
else
{var infoDesc=Ti.UI.createLabel({text:fStripped,color:'White',textAlign:'left',left:10,top:8,height:18,font:{fontWeight:'bold',fontSize:13}});}
Ti.API.warn(info[i].title);row.add(infoDesc);tableData[i]=row;}
tableview=Ti.UI.createTableView({data:tableData,height:280,separatorColor:'#C9EE00',backgroundColor:'transparent'});if(Ti.Platform.osname=='ipad'){tableview.height=770;tableview.top=70;}
else
{tableview.top=31;}
if(Ti.Platform.name=='android'){tableview.top=0;row.height=120;}
else{hideIndicator();}
tableview.addEventListener('click',function(e){var index=e.index;var section=e.section;var row=e.row;var rowdata=e.rowData;var audioPlayer=Ti.UI.createWindow({url:'gdsAudioPlayer.js'});var scUrl=info[e.index].stream_url;audioPlayer.scURL=scUrl;audioPlayer.trackTitle=info[e.index].title;Ti.API.warn('Null Desc'+info[e.index].description);if(info[e.index].description=="")
{Ti.API.warn('Null Desc'+info[e.index].description);audioPlayer.trackDesc='GDS - Show';}
else
{audioPlayer.trackDesc=info[e.index].description;}
audioPlayer.trackDuration=info[e.index].duration;Ti.UI.currentTab.open(audioPlayer,{animated:true});});Ti.UI.currentWindow.add(tableview);}